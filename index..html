<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>A to Z Packers & Movers — Live Tracking</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f5f7fb; --surface:#ffffff; --ink:#0f172a; --muted:#5b6b82; --line:#e6e8ee;
      --brand:#174ea6; --brand-2:#0b3a8d; --ok:#0f766e; --warn:#b45309; --danger:#b91c1c;
      --pill:#eef2ff; --pill-b:#dbe3ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#f6f8fd 0%, #f3f6fc 40%, #eef2f9 100%);font:15.5px/1.5 Inter,system-ui,Segoe UI,Roboto,Arial;color:var(--ink)}
    .wrap{max-width:980px;margin:0 auto;padding:24px 16px}/* Hero */
.hero{display:flex;gap:18px;align-items:center;background:radial-gradient(1200px 200px at 30% -40%, #e6eeff, transparent 60%), var(--brand);
  color:#fff;border-radius:18px;padding:18px 18px 18px 18px;box-shadow:0 8px 32px rgba(23,78,166,.25)}
.hero h1{margin:0;font-size:22px;letter-spacing:.2px}
.hero small{opacity:.85}

/* Cards */
.card{background:var(--surface);border:1px solid var(--line);border-radius:16px;padding:18px;margin-top:18px;box-shadow:0 1px 2px rgba(16,24,40,.04)}
.title{font-weight:700;font-size:18px;margin:0 0 10px}
.muted{color:var(--muted)}

/* Inputs */
label{font-size:13px;color:var(--muted)}
input,select,button{font:inherit}
input,select{width:100%;padding:12px;border:1px solid var(--line);border-radius:12px;background:#fff}
.row{display:grid;gap:12px}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media(max-width:740px){.grid2{grid-template-columns:1fr}}

button{appearance:none;border:0;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer}
.btn{background:var(--brand);color:#fff}
.btn:disabled{opacity:.6;cursor:not-allowed}
.btn-ghost{background:#eef2ff;color:#27346a;border:1px solid var(--pill-b)}
.btn-danger{background:var(--danger);color:#fff}

/* Result */
.pill{display:inline-block;background:var(--pill);border:1px solid var(--pill-b);color:#27346a;padding:4px 10px;border-radius:999px;font-size:12px}
.meta{display:flex;gap:8px;flex-wrap:wrap}
.meta .k{background:#f8fafc;border:1px solid var(--line);padding:8px 10px;border-radius:10px}

/* stepper */
.timeline{position:relative;margin-left:20px;margin-top:10px}
.timeline:before{content:"";position:absolute;left:6px;top:0;bottom:0;width:2px;background:#c7d2fe}
.ti{position:relative;margin:12px 0 12px 14px;padding-left:14px}
.ti:before{content:"";position:absolute;left:-8px;top:6px;width:10px;height:10px;border-radius:50%;background:#1d4ed8;box-shadow:0 0 0 3px #e0e7ff}

footer{margin:28px 0 10px;text-align:center;color:var(--muted);font-size:13px}

/* ADMIN (hidden unless #admin) */
.hidden{display:none}
.section-h{font-size:12px;text-transform:uppercase;letter-spacing:.12em;color:var(--muted);margin:14px 0 6px}
.panel{border:1px dashed var(--line);padding:12px;border-radius:14px;background:#fbfcfe}

  </style>
</head>
<body>
  <div class="wrap">
    <!-- Hero -->
    <div class="hero">
      <div>
        <h1> A to Z Packers & Movers — Live Tracking</h1>
        <small>Reliable • Ontime • DoortoDoor</small>
      </div>
    </div><!-- Public TRACK CARD -->
<div class="card" id="trackCard">
  <p class="title"> Track Your Shipment</p>
  <div class="grid2">
    <div>
      <label for="trackInput">Enter Tracking ID</label>
      <input id="trackInput" placeholder="AZ250821-8226" />
    </div>
    <div style="display:flex;align-items:flex-end">
      <button id="btnTrack" class="btn" style="width:100%">Track Now</button>
    </div>
  </div>

  <div id="result" class="row" style="margin-top:14px;display:none">
    <div class="grid2" style="align-items:center">
      <div>
        <div id="rName" style="font-weight:700;font-size:18px">-</div>
        <div id="rContact" class="muted">-</div>
      </div>
      <div style="text-align:right">
        <span id="rTid" class="pill">-</span>
      </div>
    </div>
    <div class="muted" id="rRoute" style="margin-top:6px">-</div>
    <div class="meta" id="rMeta" style="margin-top:6px"></div>
    <div class="timeline" id="rTimeline"></div>
  </div>
  <div id="noResult" class="muted" style="display:none;margin-top:10px">No shipment found for that ID.</div>
</div>

<!-- ADMIN AREA : visible only if URL has #admin -->
<div id="adminArea" class="hidden">
  <div class="section-h">Admin Login</div>
  <div class="panel" style="margin-bottom:16px">
    <div class="grid2">
      <div>
        <label>Email</label>
        <input id="email" type="email" value="manojgatibbi506@gmail.com" />
      </div>
      <div>
        <label>Password</label>
        <input id="password" type="password" />
      </div>
    </div>
    <div class="grid2" style="margin-top:10px">
      <button id="btnSignIn" class="btn">Sign In</button>
      <button id="btnSignOut" class="btn-danger">Sign Out</button>
    </div>
    <div id="loginState" class="muted" style="margin-top:8px">Not signed in</div>
  </div>

  <div class="section-h">Create New Order</div>
  <div class="panel" style="margin-bottom:16px">
    <div class="grid2">
      <div>
        <label>Customer Name</label>
        <input id="name" placeholder="Full name">
      </div>
      <div>
        <label>Contact</label>
        <input id="contact" placeholder="+91 98xxxxxxx">
      </div>
    </div>
    <div class="grid2" style="margin-top:10px">
      <div>
        <label>From (pickup city)</label>
        <input id="from" placeholder="Origin">
      </div>
      <div>
        <label>To (destination)</label>
        <input id="to" placeholder="Destination">
      </div>
    </div>
    <div class="grid2" style="margin-top:10px">
      <div>
        <label>Total number of items</label>
        <input id="items" type="number" min="1" placeholder="e.g. 12">
      </div>
      <div>
        <label>Expected Delivery Date</label>
        <input id="edd" type="date">
      </div>
    </div>
    <div class="grid2" style="margin-top:10px">
      <div>
        <label>Tracking ID (auto)</label>
        <input id="newTid" readonly>
      </div>
      <div style="display:flex;align-items:end;gap:12px">
        <button id="btnCreate" class="btn" style="width:100%">Save New Entry (Booked)</button>
      </div>
    </div>
    <div id="createNote" class="muted" style="margin-top:6px"></div>
  </div>

  <div class="section-h">Quick Status Update</div>
  <div class="panel">
    <div class="grid2">
      <div>
        <label>Tracking ID</label>
        <input id="updTid" placeholder="e.g. AZ250821-8226" />
      </div>
      <div>
        <label>Next Status (auto)</label>
        <input id="nextStatus" readonly />
      </div>
    </div>
    <div id="locRow" class="row" style="margin-top:10px;display:none">
      <div>
        <label>Location / Note (for Destination In / Out)</label>
        <input id="locNote" placeholder="e.g. Cuttack Hub, Palam Gate">
      </div>
    </div>
    <div class="row" style="margin-top:10px">
      <button id="btnAddNext" class="btn">Add Next Status</button>
      <div id="updNote" class="muted"></div>
    </div>
  </div>
</div>

<footer>© A to Z Packers & Movers • Live Tracking Portal</footer>

  </div>  <!-- Firebase SDKs -->  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, arrayUnion, serverTimestamp, Timestamp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    // Your existing Firebase project (works out of the box)
    const firebaseConfig = {
      apiKey: "AIzaSyAOCeCbqVvki8LN0LLQFNkLOwEoYer3EKQ",
      authDomain: "a-to-z-packers-tracking-live.firebaseapp.com",
      projectId: "a-to-z-packers-tracking-live",
      storageBucket: "a-to-z-packers-tracking-live.firebasestorage.app",
      messagingSenderId: "719198128823",
      appId: "1:719198128823:web:d7ef4235dda458ff375b32",
      measurementId: "G-B4KR2RETYR"
    };

    const app   = initializeApp(firebaseConfig);
    const auth  = getAuth(app);
    const db    = getFirestore(app);

    // Reveal admin only when URL ends with #admin
    const adminArea = document.querySelector('#adminArea');
    if (location.hash === '#admin') adminArea.classList.remove('hidden');

    const $ = s => document.querySelector(s);
    const format = ts => { try { const d = ts?.toDate ? ts.toDate() : (typeof ts === 'number' ? new Date(ts) : new Date()); return d.toLocaleString(); } catch { return '-'; } };
    const formatDate = ts => { try { const d = ts?.toDate ? ts.toDate() : new Date(ts); return d.toLocaleDateString(); } catch { return '-'; } };

    const FLOW = ["Booked","Picked Up","In Transit","Destination In","Destination Out","Out for Delivery","Delivered"];

    // ===== Auth (only wires if admin visible) =====
    if (!adminArea.classList.contains('hidden')) {
      onAuthStateChanged(auth, (user) => { $('#loginState').textContent = user ? `Signed in as ${user.email}` : 'Not signed in'; });
      $('#btnSignIn').onclick = async () => { try { await signInWithEmailAndPassword(auth, $('#email').value.trim(), $('#password').value.trim()); alert('Signed in!'); } catch(e){ alert(e.message); } };
      $('#btnSignOut').onclick = async () => { try { await signOut(auth); alert('Signed out.'); } catch(e){ alert(e.message); } };
    }

    // Helpers
    function makeTid(){
      const now = new Date();
      const dd = String(now.getDate()).padStart(2,"0");
      const mm = String(now.getMonth()+1).padStart(2,"0");
      const yy = String(now.getFullYear()).slice(-2);
      const rand = Math.floor(1000 + Math.random()*9000);
      return `AZ${dd}${mm}${yy}-${rand}`;
    }
    const newTid = $('#newTid'); if (newTid) newTid.value = makeTid();

    // Create order
    const btnCreate = $('#btnCreate');
    if (btnCreate) btnCreate.onclick = async () => {
      const user = auth.currentUser; if(!user){ alert('Please sign in first.'); return; }
      const tid = $('#newTid').value.trim();
      const name = $('#name').value.trim() || '-';
      const contact = $('#contact').value.trim() || '-';
      const from = $('#from').value.trim() || '-';
      const to = $('#to').value.trim() || '-';
      const items = parseInt($('#items').value || '0', 10) || 0;
      const eddVal = $('#edd').value; const eddTs = eddVal ? Timestamp.fromDate(new Date(eddVal + 'T12:00:00')) : null;
      try{
        await setDoc(doc(db,'Orders',tid),{ Name:name, Contact:contact, From:from, To:to, Items:items, EDD:eddTs, Status:[{Text:'Booked', Ts:serverTimestamp()}] });
        $('#createNote').textContent = `Created order ${tid}`; $('#updTid').value = tid; await computeNextStatus(); alert('Order saved with Tracking ID: '+tid); $('#newTid').value = makeTid();
      }catch(e){ alert('Save failed: '+e.message); }
    };

    // Compute next status and toggle location field for Destination In/Out
    async function computeNextStatus(){
      const tid = ($('#updTid')?.value || '').trim(); if(!tid){ $('#nextStatus').value=''; $('#locRow').style.display='none'; return; }
      const ref = doc(db,'Orders',tid); const snap = await getDoc(ref); if(!snap.exists()){ $('#nextStatus').value=''; $('#locRow').style.display='none'; return; }
      const data = snap.data() || {}; const texts = (data.Status||[]).map(s=>s.Text);
      let idx=-1; for(let i=0;i<FLOW.length;i++){ if(texts.includes(FLOW[i])) idx=i; else break; }
      const delivered = texts.includes('Delivered');
      const next = delivered ? 'Delivered (complete)' : FLOW[Math.min(idx+1, FLOW.length-1)];
      $('#nextStatus').value = next;
      const needsLoc = next==='Destination In' || next==='Destination Out';
      $('#locRow').style.display = needsLoc ? '' : 'none'; if(!needsLoc) $('#locNote').value='';
    }
    if ($('#updTid')) $('#updTid').addEventListener('input', computeNextStatus);

    // Add next status
    if ($('#btnAddNext')) $('#btnAddNext').onclick = async () => {
      const user = auth.currentUser; if(!user){ alert('Please sign in first.'); return; }
      const tid = $('#updTid').value.trim(); if(!tid){ alert('Enter Tracking ID.'); return; }
      try{
        const ref = doc(db,'Orders',tid); const snap = await getDoc(ref); if(!snap.exists()){ alert('No such order.'); return; }
        const data = snap.data() || {}; const texts = (data.Status||[]).map(s=>s.Text);
        if(texts.includes('Delivered')){ alert('Already delivered.'); return; }
        let pos=-1; for(let i=0;i<FLOW.length;i++){ if(texts.includes(FLOW[i])) pos=i; else break; }
        const next = FLOW[pos+1] || 'Delivered';
        let label = next; const needsLoc = next==='Destination In' || next==='Destination Out';
        if(needsLoc){ const note = ($('#locNote').value||'').trim(); if(note) label = `${next} — ${note}`; }
        await updateDoc(ref,{ Status: arrayUnion({Text:label, Ts:serverTimestamp()}) });
        $('#updNote').textContent = `Added "${label}" at ${new Date().toLocaleString()}`; alert('Status added.'); await computeNextStatus();
      }catch(e){ alert('Update failed: '+e.message); }
    };

    // Public Track
    $('#btnTrack').onclick = async () => {
      const tid = $('#trackInput').value.trim(); if(!tid){ alert('Enter Tracking ID.'); return; }
      try{
        const ref = doc(db,'Orders',tid); const snap = await getDoc(ref);
        if(!snap.exists()){ document.querySelector('#result').style.display='none'; document.querySelector('#noResult').style.display=''; return; }
        document.querySelector('#noResult').style.display='none'; const d = snap.data();
        $('#rName').textContent = d.Name||'-'; $('#rContact').textContent = d.Contact||'-'; $('#rTid').textContent = tid; $('#rRoute').textContent = `${d.From||'-'}  ${d.To||'-'}`;
        const meta = [];
        if(d.Items) meta.push(`<span class=\"k\">Items: ${d.Items}</span>`);
        if(d.EDD) meta.push(`<span class=\"k\">Expected Delivery: ${formatDate(d.EDD)}</span>`);
        $('#rMeta').innerHTML = meta.join('');
        const items = (d.Status||[]).slice().sort((a,b)=>{ const ta=a.Ts?.seconds||0, tb=b.Ts?.seconds||0; return ta-tb; });
        const tl = $('#rTimeline'); tl.innerHTML='';
        items.forEach(s=>{ const div=document.createElement('div'); div.className='ti'; div.innerHTML = `<div style=\"font-weight:600\">${s.Text}</div><div class=\"muted\">${format(s.Ts)}</div>`; tl.appendChild(div); });
        document.querySelector('#result').style.display='';
      }catch(e){ alert('Load failed: '+e.message); }
    };

    if (!adminArea.classList.contains('hidden')) computeNextStatus();
  </script></body>
</html>